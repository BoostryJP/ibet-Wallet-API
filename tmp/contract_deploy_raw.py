# -*- coding: utf-8 -*-
import json
import rlp

from ethereum.transactions import Transaction
import ethereum.utils as utils

from web3 import Web3

web3 = Web3(Web3.HTTPProvider('http://localhost:8545'))

from_address = '0x7ae52ca0c275982bb1c27e7ef5a6e920aad655c2'
from_privkey = '1ec98a827475a44e7727df8816a5717e99ad65b6880f7e299afd92cd88e2ec6c'

bytecode_str =  '6060604052341561000f57600080fd5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506103d78061005e6000396000f300606060405260043610610057576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063867904b41461005c578063a9059cbb1461009e578063f8b2cb4f146100e0575b600080fd5b341561006757600080fd5b61009c600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803590602001909190505061012d565b005b34156100a957600080fd5b6100de600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506101d9565b005b34156100eb57600080fd5b610117600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610362565b6040518082815260200191505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561018857600080fd5b80600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055505050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054101561022557600080fd5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055507fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef338383604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a15050565b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490509190505600a165627a7a72305820ea5065c9497af6263d046d6e06e3c036a504796f1ccb406510b9b8e980715cba0029'

bytecode = utils.decode_hex(bytecode_str)

print(bytecode)

tx = Transaction(
    nonce=web3.eth.getTransactionCount(from_address),
    to='',
    value=0,
    gasprice=web3.eth.gasPrice,
    startgas=999999,
    data=bytecode,
    )

print('-----tx-----')
print(tx)

tx.sign(from_privkey)

raw_tx = rlp.encode(tx)
raw_tx_hex = web3.toHex(raw_tx)

print('-----rawTx-----')
print(raw_tx)

response = web3.eth.sendRawTransaction(raw_tx_hex)
print(response)
